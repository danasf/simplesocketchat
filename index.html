<!doctype html>
<html>
	<head>
	<style>
		* { margin:0; padding:0; }
		body { }
		form { background:#000; padding:10px; position: fixed; bottom:0; width:100%; }
		#messages { list-style-type:none; margin:0; padding:0; }
		#messages li { padding: 10px; }
		#messages li:nth-child(odd) { background:#eee; }
		#m { width:80%; border:0; font-size:1.5em; }
		button { padding:10px; background:#00baaa; border:0px;}
	</style>
	</head>
	<body>
		<ul id="messages">
			<li>Welcome to chat!</li>
		</ul>
		<form action="">
			<input id="m" autocomplete="off" /><button type="button" id="send">Send</button>
		</form>
		<script type="text/javascript" src="/socket.io/socket.io.js"></script>
		<script>

			var send = document.getElementById('send');
			var msgs = document.getElementById('messages');
			var input = document.getElementById('m');
			var sock = io.connect('http://localhost:8888');

			send.addEventListener('click',function(e) {
				if(input.value.length > 0 ) {
					console.log("sending a message...");
					sock.emit('chatMsg',{ user:'someone',message:input.value });
				}
			},false);


			sock.on('hi', function (data) {
				msgs.appendChild(addNewItem(data.message));
				console.log("received",data);
			});

			sock.on('newMsg', function (data) {
				msgs.appendChild(addNewItem(data.message));
				console.log("received",data);
			});


			function addNewItem(mesg) {
				//var listitem = document.createElement("LI");
				//var text = document.createTextNode(msg);
				//return listitem.appendChild(text);
				var node=document.createElement("LI");
				var textnode=document.createTextNode(mesg);
				node.appendChild(textnode);
				return node;
			}

		</script>
	</body>
</html>